{% extends "core/base.html" %}
{% load static %}

{% block title %}Monthly Trend Report{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <h2 class="mb-3">Monthly Trend</h2>

  <div class="chart-container" style="height:500px;">
    <canvas id="monthlyTrendChart"></canvas>
    <p id="monthlyTrendNoData" class="text-center mt-3 d-none">No data available.</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const monthlyTrendData = {{ monthly_trends_data|safe }};
  const monthLabels = {{ month_labels|safe }};

  const colors = ['#4e79a7','#f28e2b','#59a14f','#edc949','#e15759','#76b7b2','#af7aa1','#ff9da7'];

  if(monthlyTrendData.length){
    new Chart('monthlyTrendChart', {
      type: 'line',
      data: {
        labels: monthLabels,
        datasets: monthlyTrendData.map((item,i)=>({
          label: item.indicator,
          data: item.values,
          borderColor: colors[i % colors.length],
          backgroundColor: colors[i % colors.length]+'33',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 7
        }))
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { 
            position: 'bottom', 
            labels: { usePointStyle: true, boxWidth:12, padding:10 } 
          },
          datalabels: { 
            color: '#000', 
            anchor: 'end', 
            align: 'top', 
            font: { weight: 'bold', size: 12 },
            formatter: function(value, context) { return value; }
          },
          tooltip: {
            enabled: true,
            mode: 'nearest',
            intersect: false
          }
        },
        scales: {
          y: { 
            beginAtZero: true,
            ticks: { precision:0 }
          },
          x: {
            ticks: { autoSkip: false }
          }
        }
      },
      plugins: [ChartDataLabels]
    });
  } else {
    document.getElementById('monthlyTrendNoData').classList.remove('d-none');
  }
});
</script>
{% endblock %}
